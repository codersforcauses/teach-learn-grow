# Migration `20200116185516-progs-apps-users`

This migration has been generated by SeanCottrill at 1/16/2020, 6:55:16 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "lift"."Program" (
  "applicationEndDate" DATE NOT NULL DEFAULT '1970-01-01 00:00:00'  ,
  "applicationStartDate" DATE NOT NULL DEFAULT '1970-01-01 00:00:00'  ,
  "description" TEXT NOT NULL DEFAULT ''  ,
  "endDate" DATE NOT NULL DEFAULT '1970-01-01 00:00:00'  ,
  "id" TEXT NOT NULL   ,
  "name" TEXT NOT NULL DEFAULT ''  ,
  "programType" TEXT NOT NULL DEFAULT 'rural'  ,
  "startDate" DATE NOT NULL DEFAULT '1970-01-01 00:00:00'  ,
  "updatedAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00'  ,
  PRIMARY KEY ("id")
);

CREATE TABLE "lift"."Application" (
  "applicationDate" DATE NOT NULL DEFAULT '1970-01-01 00:00:00'  ,
  "id" TEXT NOT NULL   ,
  "program" TEXT NOT NULL   REFERENCES "Program"(id) ON DELETE RESTRICT,
  "status" TEXT NOT NULL DEFAULT 'pending'  ,
  "user" TEXT    REFERENCES "User"(id) ON DELETE SET NULL,
  PRIMARY KEY ("id")
);
```

## Changes

```diff
diff --git datamodel.mdl datamodel.mdl
migration 20191228124159-permission..20200116185516-progs-apps-users
--- datamodel.dml
+++ datamodel.dml
@@ -1,21 +1,31 @@
 datasource sqlite {
   provider = "sqlite"
-  url = "***"
+  url      = "file:dev.db"
   enabled  = true
 }
 // This is used in prod
 // datasource db {
 //   provider = "mysql"
-     url = "***"
+//   url      = env("MYSQL_URL")
 //   default  = true
 // }
 generator photon {
   provider = "photonjs"
 }
+enum ProgramType {
+  rural
+}
+
+enum ApplicationStatus {
+  pending
+  accepted
+  rejected
+}
+
 model Permission {
   name        String   @default(cuid()) @id
   description String
   createdAt   DateTime @default(now())
@@ -30,17 +40,18 @@
   updatedAt   DateTime     @updatedAt
 }
 model User {
-  id          String       @default(cuid()) @id
-  email       String?      @unique
-  name        String?
-  nickname    String?
-  avatarUrl   String
-  posts       Post[]
-  messages    Message[]
-  roles       Role[]
-  permissions Permission[]
+  id            String       @default(cuid()) @id
+  email         String?      @unique
+  name          String?
+  nickname      String?
+  avatarUrl     String
+  posts         Post[]
+  messages      Message[]
+  roles         Role[]
+  permissions   Permission[]
+  applications  Application[]
 }
 model Post {
   id        String   @default(cuid()) @id
@@ -57,5 +68,25 @@
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt
   text      String
   author    User
+}
+
+model Program {
+  id                      String         @default(cuid()) @id
+  name                    String   
+  description             String
+  programType             ProgramType
+  startDate               DateTime
+  endDate                 DateTime
+  applicationStartDate    DateTime
+  applicationEndDate      DateTime
+  updatedAt               DateTime       @updatedAt
+  applications            Application[]
+}
+
+model Application {
+  id                  String               @default(cuid()) @id
+  program             Program     
+  status              ApplicationStatus 
+  applicationDate     DateTime             @default(now())
 }
```

## Photon Usage

You can use a specific Photon built for this migration (20200116185516-progs-apps-users)
in your `before` or `after` migration script like this:

```ts
import Photon from '@generated/photon/20200116185516-progs-apps-users'

const photon = new Photon()

async function main() {
  const result = await photon.users()
  console.dir(result, { depth: null })
}

main()

```
