# Migration `20191228124159-permission`

This migration has been generated by Pixeladed at 12/28/2019, 12:41:59 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP TABLE "lift"."User_roles";

CREATE TABLE "lift"."Permission" (
  "createdAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00'  ,
  "description" TEXT NOT NULL DEFAULT ''  ,
  "name" TEXT NOT NULL   ,
  "role" TEXT    REFERENCES "Role"(name) ON DELETE SET NULL,
  "updatedAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00'  ,
  "user" TEXT    REFERENCES "User"(id) ON DELETE SET NULL,
  PRIMARY KEY ("name")
);

CREATE TABLE "lift"."Role" (
  "createdAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00'  ,
  "description" TEXT NOT NULL DEFAULT ''  ,
  "name" TEXT NOT NULL   ,
  "updatedAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00'  ,
  "user" TEXT    REFERENCES "User"(id) ON DELETE SET NULL,
  PRIMARY KEY ("name")
);
```

## Changes

```diff
diff --git datamodel.mdl datamodel.mdl
migration 20191205145929-init..20191228124159-permission
--- datamodel.dml
+++ datamodel.dml
@@ -1,35 +1,46 @@
 datasource sqlite {
   provider = "sqlite"
-  url = "***"
+  url      = "file:dev.db"
   enabled  = true
 }
 // This is used in prod
 // datasource db {
 //   provider = "mysql"
-     url = "***"
+//   url      = env("MYSQL_URL")
 //   default  = true
 // }
-enum Role {
-  USER
-  ADMIN
-}
-
 generator photon {
   provider = "photonjs"
 }
+model Permission {
+  name        String   @default(cuid()) @id
+  description String
+  createdAt   DateTime @default(now())
+  updatedAt   DateTime @updatedAt
+}
+
+model Role {
+  name        String       @default(cuid()) @id
+  description String
+  permissions Permission[]
+  createdAt   DateTime     @default(now())
+  updatedAt   DateTime     @updatedAt
+}
+
 model User {
-  id        String    @default(cuid()) @id
-  email     String?   @unique
-  name      String?
-  nickname  String?
-  avatarUrl String
-  posts     Post[]
-  messages  Message[]
-  roles     Role[]
+  id          String       @default(cuid()) @id
+  email       String?      @unique
+  name        String?
+  nickname    String?
+  avatarUrl   String
+  posts       Post[]
+  messages    Message[]
+  roles       Role[]
+  permissions Permission[]
 }
 model Post {
   id        String   @default(cuid()) @id
```

## Photon Usage

You can use a specific Photon built for this migration (20191228124159-permission)
in your `before` or `after` migration script like this:

```ts
import Photon from '@generated/photon/20191228124159-permission'

const photon = new Photon()

async function main() {
  const result = await photon.users()
  console.dir(result, { depth: null })
}

main()

```
